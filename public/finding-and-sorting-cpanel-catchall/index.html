<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.53" />

  
  <meta name="description" content="A collection of things that Iâ€™ve worked on and interesting projects that you may find useful.">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://www.danieljw.net/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://www.danieljw.net/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://www.danieljw.net/favicon-16x16.png">

  
  <link rel="manifest" href="https://www.danieljw.net/site.webmanifest">

  
  <link rel="mask-icon" href="https://www.danieljw.net/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://www.danieljw.net/css/bootstrap.min.css" />

  
  <title>Finding and sorting cPanel catchall | danieljw.net</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #FAFAFA;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #336699;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="https://github.com/djw4">Projects</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Finding and sorting cPanel catchall</h1>
<p>
  <small class="text-secondary">
  
  
  Apr 6, 2012
  </small>
  
</p>
<p>In it&rsquo;s default configuration cPanel&rsquo;s email facilities have a feature called the &lsquo;Default Address&rsquo;, which accepts mail sent to a domain that didn&rsquo;t match any available mailboxes on the server.</p>

<p>Whilst great in theory it can prove problematic if not checked regularly by the customer or by the server administrator. Due to it&rsquo;s inherent ability to accept mail from anyone, to anyone (at the domain) the default address will frequently fill up with spam emails which does nothing but soak up disk space on the server.</p>

<p>Fortunately I&rsquo;ve come up with a one-liner bash statement that will scan all default addresses on a server, count the number of emails inside, and sort those for you. You could easily build on this statement to email the server administrator when emails go over a certain limit using cron.</p>

<p>The statement looks like this:</p>

<pre><code>for i in `ls -A1 /var/cpanel/users`; do \
echo $i `find /home/$i/mail/cur/ -type f | wc -l`; done | \
awk -F ' ' '{print $NF,$0}' | sort -n | cut -f2- -d' '
</code></pre>

<p>Whilst fairly basic, the statement does the following:</p>

<ul>
<li>For every cPanel user on the server,</li>
<li>Print the user, find files in the user&rsquo;s <code>~/mail/cur/</code> directory,
then count the number of found files,</li>
<li>Process the STDOUT to print only the username and count of files,</li>
<li>Then sort in a descending order</li>
</ul>

<p>An example of this working being:</p>

<pre><code>...
shutterw-331
villaget-514
swarchit-609
teamsbrc-662
tksteelc-5435
mclesolu-41435
</code></pre>

<p>The statement below then deletes all files in this directory (the largest directory) that is older than 1 year (and likely not needed any longer):</p>

<p><code>find /home/mclesolu/mail/cur/ -type f -mtime +365 -delete</code></p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>