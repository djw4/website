<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from 192.168.99.100:32770/ansible-inventory-from-netbox/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 22 Nov 2018 00:29:33 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Ansible inventory from Netbox</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="../assets/built/screen0e5e.css?v=cb2044d874" />

    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />
    <link rel="canonical" href="/ansible-inventory-from-netbox/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="/ansible-inventory-from-netbox/amp/" />
    
    <meta property="og:site_name" content="Daniel JW" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Ansible inventory from Netbox" />
    <meta property="og:description" content="We have been using the excellent Netbox IPAM and DCIM tool internally for tracking our networking configurations, as well as our backend infrastructure whilst also increasing the use of Ansible to remove repetetive tasks in the day-to-day. By utilising Netbox as the end-point for accessing service data, this gives us" />
    <meta property="og:url" content="/ansible-inventory-from-netbox/" />
    <meta property="article:published_time" content="2018-11-22T00:28:31.000Z" />
    <meta property="article:modified_time" content="2018-11-22T00:28:31.000Z" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Ansible inventory from Netbox" />
    <meta name="twitter:description" content="We have been using the excellent Netbox IPAM and DCIM tool internally for tracking our networking configurations, as well as our backend infrastructure whilst also increasing the use of Ansible to remove repetetive tasks in the day-to-day. By utilising Netbox as the end-point for accessing service data, this gives us" />
    <meta name="twitter:url" content="/ansible-inventory-from-netbox/" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Daniel W" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Daniel JW",
        "logo": "https://static.ghost.org/v1.0.0/images/ghost-logo.svg"
    },
    "author": {
        "@type": "Person",
        "name": "Daniel W",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/67360e78a0fd12bc9da19d7387354efa?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "/author/daniel/",
        "sameAs": []
    },
    "headline": "Ansible inventory from Netbox",
    "url": "/ansible-inventory-from-netbox/",
    "datePublished": "2018-11-22T00:28:31.000Z",
    "dateModified": "2018-11-22T00:28:31.000Z",
    "description": "We have been using the excellent Netbox IPAM and DCIM tool internally for tracking our networking configurations, as well as our backend infrastructure whilst also increasing the use of Ansible to remove repetetive tasks in the day-to-day. By utilising Netbox as the end-point for accessing service data, this gives us",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "/"
    }
}
    </script>

    <script src="../public/ghost-sdk.min0e5e.js?v=cb2044d874"></script>
<script>
ghost.init({
	clientId: "ghost-frontend",
	clientSecret: "f2f32b3ee508"
});
</script>
    <meta name="generator" content="Ghost 2.6" />
    <link rel="alternate" type="application/rss+xml" title="Daniel JW" href="/rss/" />

</head>
<body class="post-template">

    <div class="site-wrapper">

        

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
                <a class="site-nav-logo" href="/"><img src="https://static.ghost.org/v1.0.0/images/ghost-logo.svg" alt="Daniel JW" /></a>
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-tag" role="menuitem"><a href="/tag/getting-started/">Tag</a></li>
    <li class="nav-author" role="menuitem"><a href="/author/ghost/">Author</a></li>
    <li class="nav-help" role="menuitem"><a href="https://help.ghost.org/">Help</a></li>
</ul>

    </div>
    <div class="site-nav-right">
        <div class="social-links">
        </div>
            <a class="rss-button" href="https://feedly.com/i/subscription/feed//rss/" title="RSS" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg>
</a>
    </div>
</nav>
    </div>
</header>


<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post no-image">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="2018-11-22">22 November 2018</time>
                </section>
                <h1 class="post-full-title">Ansible inventory from Netbox</h1>
            </header>


            <section class="post-full-content">
                <div class="post-content">
                    <p>We have been using the excellent <a href="https://github.com/digitalocean/netbox">Netbox</a> IPAM and DCIM tool internally for tracking our networking configurations, as well as our backend infrastructure whilst also increasing the use of Ansible to remove repetetive tasks in the day-to-day. By utilising Netbox as the end-point for accessing service data, this gives us the opportunity to extrapolate the request for information from our billing and management server - siloing off our infrastructure automation behind a layer of security that was otherwise impossible.</p><p>Netbox then becomes the single pane of glass that can be polled for information at any time, using a standarised REST interface - great stuff.</p><p>The only issue for us was - how to make use of this information? We already make use of Ansible, but it's inventories have bene static up until now but thankfully <a href="https://docs.ansible.com/ansible/2.7/user_guide/intro_dynamic_inventory.html">dynamic inventories</a> to the rescue.</p><hr><p>To cut a long story short:</p><ul><li>  Netbox exposes a REST API that can be polled for information.  </li><li>  Ansible dynamic inventories are passed through to Ansible in JSON format.  </li></ul><p>The script included below is a dynamic inventory written in Python, however unfortunately at the moment it is only compatible with Python3. A few key points for this script to run properly:</p><ul><li>  Custom fields are being used to filter IP addresses per 'operating system' and whether or not the IP address is the 'primary' address (no an alias). For example: <code>"custom_fields": {"os": {"value": 3,"label": "linux-ubuntu"},"ip-type": {"value": 1,"label": "primary"}}</code>.  </li><li>  We use the same SSH port for most servers - so this is baked into the config but easy to modify later if needed.  </li><li>  The token is only necessary if your Netbox server is set up to require authentication when accessing data, normally this isn't required though (ie. public read-only).  </li></ul><script src="https://gist.github.com/djw4/ca3268dd1d13eeee1589f17ebc673a52.js"></script><p>Ansible will use the flag <code>--list</code>, so you can simulate this by passing in that flag and the script will output something like this:</p><pre><code>{
    'windows-server-standard': {
        'hosts': ['1.2.3.4', .. '1.2.3.7'],
        'vars': {}
    },
    'linux-ubuntu': {
        'hosts': ['1.2.3.10', .. '1.2.3.150'],
        'vars': {
            'ansible_connection': 'ssh',
            'ansible_ssh_user': 'user',
            'ansible_ssh_port': '22222'
        }
    }
}
</code></pre>
                </div>
            </section>


            <footer class="post-full-footer">


                    
<section class="author-card">
        <img class="author-profile-image" src="http://www.gravatar.com/avatar/67360e78a0fd12bc9da19d7387354efa?s=250&amp;d=mm&amp;r=x" alt="Daniel W" />
    <section class="author-card-content">
        <h4 class="author-card-name"><a href="../author/daniel/index.html">Daniel W</a></h4>
            <p>Read <a href="../author/daniel/index.html">more posts</a> by this author.</p>
    </section>
</section>
<div class="post-full-footer-right">
    <a class="author-card-button" href="../author/daniel/index.html">Read More</a>
</div>


            </footer>


        </article>

    </div>
</main>

<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">


                <article class="post-card post no-image">
    <div class="post-card-content">
        <a class="post-card-content-link" href="../ansible-golden-image-config-replacements/index.html">
            <header class="post-card-header">
                <h2 class="post-card-title">Ansible golden image config replacements</h2>
            </header>
            <section class="post-card-excerpt">
                <p>ConfigServer Security &amp; Firewall is a popular wrapper for iptables, especially when used in conjunction with the hosting platform cPanel. The 'firewall' itself is very feature rich and contains different abilities, some of</p>
            </section>
        </a>
        <footer class="post-card-meta">

            <ul class="author-list">
                <li class="author-list-item">

                    <div class="author-name-tooltip">
                        Daniel W
                    </div>

                        <a href="../author/daniel/index.html" class="static-avatar"><img class="author-profile-image" src="http://www.gravatar.com/avatar/67360e78a0fd12bc9da19d7387354efa?s=250&amp;d=mm&amp;r=x" alt="Daniel W" /></a>
                </li>
            </ul>

            <span class="reading-time">1 min read</span>

        </footer>
    </div>
</article>

        </div>
    </div>
</aside>

<div class="floating-header">
    <div class="floating-header-logo">
        <a href="/">
            <span>Daniel JW</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Ansible inventory from Netbox</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Ansible%20inventory%20from%20Netbox&amp;url=/ansible-inventory-from-netbox/"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=/ansible-inventory-from-netbox/"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
        </a>
    </div>
    <progress id="reading-progress" class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>




        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="/">Daniel JW</a> &copy; 2018</section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org/" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>


    <script>
        var images = document.querySelectorAll('.kg-gallery-image img');
        images.forEach(function (image) {
            var container = image.closest('.kg-gallery-image');
            var width = image.attributes.width.value;
            var height = image.attributes.height.value;
            var ratio = width / height;
            container.style.flex = ratio + ' 1 0%';
        })
    </script>


    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="../assets/built/jquery.fitvids0e5e.js?v=cb2044d874"></script>


    <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('#reading-progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();

});
</script>

<script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('#reading-progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();

});
</script>


    

</body>

<!-- Mirrored from 192.168.99.100:32770/ansible-inventory-from-netbox/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 22 Nov 2018 00:29:33 GMT -->
</html>
